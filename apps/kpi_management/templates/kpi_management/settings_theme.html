{% extends layout_path %}
{% load static %}
{% load i18n %}

{% block title %}Pengaturan Tema{% endblock %}

{% block page_css %}
{% include 'kpi_management/_dark_mode_css.html' %}
<style>
  /* Additional Dark Mode Styling for Settings Theme */
  [data-bs-theme="dark"] .card.border-primary {
    border-color: #696cff !important;
    border-width: 2px !important;
    box-shadow: 0 0 0 0.2rem rgba(105, 108, 255, 0.25) !important;
  }

  [data-bs-theme="dark"] .card:hover {
    border-color: #4E5965 !important;
  }

  [data-bs-theme="dark"] .card.border-primary:hover {
    border-color: #696cff !important;
  }

  [data-bs-theme="dark"] .form-check-label strong {
    color: #FFFFFF !important;
  }
</style>
{% endblock page_css %}

{% block content %}
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Pengaturan Tema</h5>
        <a href="{% url 'kpi_management:settings-list' %}" class="btn btn-label-secondary">
          <i class="icon-base bx bx-arrow-back me-1"></i> Kembali
        </a>
      </div>
      <div class="card-body">
        <form method="post" id="themeForm">
          {% csrf_token %}

          <div class="row">
            <div class="col-12 mb-4">
              <h6 class="mb-3">Pilih Mode Tema</h6>
              <p class="text-muted">Pilih antara mode terang (light) atau mode gelap (dark) untuk antarmuka aplikasi.</p>
            </div>
          </div>

          <div class="row g-4 mb-4">
            <!-- Light Mode -->
            <div class="col-md-6">
              <div class="card h-100 {% if current_theme == 'light' %}border-primary{% endif %}" style="cursor: pointer;" onclick="selectTheme('light')">
                <div class="card-body text-center">
                  <div class="mb-3">
                    <i class="icon-base bx bx-sun icon-lg text-warning" style="font-size: 3rem;"></i>
                  </div>
                  <h5 class="card-title">Mode Terang</h5>
                  <p class="text-muted">Tema terang dengan latar belakang putih</p>
                  <div class="form-check d-flex justify-content-center">
                    <input class="form-check-input" type="radio" name="theme" id="themeLight" value="light" {% if current_theme == 'light' %}checked{% endif %}>
                    <label class="form-check-label ms-2" for="themeLight">
                      {% if current_theme == 'light' %}<strong>Aktif</strong>{% else %}Pilih{% endif %}
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Dark Mode -->
            <div class="col-md-6">
              <div class="card h-100 {% if current_theme == 'dark' %}border-primary{% endif %}" style="cursor: pointer;" onclick="selectTheme('dark')">
                <div class="card-body text-center">
                  <div class="mb-3">
                    <i class="icon-base bx bx-moon icon-lg text-info" style="font-size: 3rem;"></i>
                  </div>
                  <h5 class="card-title">Mode Gelap</h5>
                  <p class="text-muted">Tema gelap dengan latar belakang hitam</p>
                  <div class="form-check d-flex justify-content-center">
                    <input class="form-check-input" type="radio" name="theme" id="themeDark" value="dark" {% if current_theme == 'dark' %}checked{% endif %}>
                    <label class="form-check-label ms-2" for="themeDark">
                      {% if current_theme == 'dark' %}<strong>Aktif</strong>{% else %}Pilih{% endif %}
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-12">
              <div class="alert alert-info">
                <i class="icon-base bx bx-info-circle me-2"></i>
                <strong>Catatan:</strong> Perubahan tema akan diterapkan secara langsung setelah menyimpan.
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-end gap-2 mt-4">
            <a href="{% url 'kpi_management:settings-list' %}" class="btn btn-label-secondary">
              <i class="icon-base bx bx-x me-1"></i> Batal
            </a>
            <button type="submit" class="btn btn-primary">
              <i class="icon-base bx bx-save me-1"></i> Simpan Perubahan
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block page_js %}
<script>
  'use strict';

  function selectTheme(theme) {
    document.getElementById('themeLight').checked = (theme === 'light');
    document.getElementById('themeDark').checked = (theme === 'dark');

    // Update card borders
    document.querySelectorAll('.card').forEach(card => {
      if (card.querySelector('input[value="' + theme + '"]')) {
        card.classList.add('border-primary');
      } else {
        card.classList.remove('border-primary');
      }
    });
  }

  // Apply theme immediately when selected
  document.addEventListener('DOMContentLoaded', function() {
    // Apply theme on page load
    const currentTheme = '{{ current_theme }}';
    if (window.ThemeToggle) {
      window.ThemeToggle.setTheme(currentTheme);
    } else {
      // Fallback: set theme directly
      document.documentElement.setAttribute('data-bs-theme', currentTheme);
      localStorage.setItem('theme', currentTheme);
    }
  });
</script>
{% endblock page_js %}

